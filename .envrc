use nix
export PATH="$HOME/.krew/bin:$PATH"

# Load completions for zsh using precmd hooks
if [ -n "$ZSH_VERSION" ]; then
  # Check if compinit is available, if not initialize it
  if ! command -v compdef &> /dev/null; then
    eval "autoload -Uz compinit && compinit"
  fi

  # Load kustomize completion via precmd hook
  if command -v kustomize &> /dev/null; then
    _load_kustomize_completion() {
      eval "$(kustomize completion zsh)"
      add-zsh-hook -d precmd _load_kustomize_completion
    }
    autoload -U add-zsh-hook
    add-zsh-hook precmd _load_kustomize_completion
  fi

  # Load flux completion via precmd hook
  if command -v flux &> /dev/null; then
    _load_flux_completion() {
      eval "$(flux completion zsh)"
      add-zsh-hook -d precmd _load_flux_completion
    }
    autoload -U add-zsh-hook
    add-zsh-hook precmd _load_flux_completion
  fi
fi
